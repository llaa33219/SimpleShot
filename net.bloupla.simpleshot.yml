app-id: net.bloupla.simpleshot
runtime: org.gnome.Platform
runtime-version: '49'
sdk: org.gnome.Sdk
command: simpleshot

finish-args:
  # Wayland support
  - --socket=wayland
  # X11 fallback
  - --socket=fallback-x11
  # GPU acceleration
  - --device=dri
  # Screen recording and screenshot via portals
  - --talk-name=org.freedesktop.portal.Desktop
  # File chooser portal for save location
  - --filesystem=xdg-pictures:create
  - --filesystem=xdg-videos:create

modules:
  - name: yasm
    sources:
      - type: archive
        url: https://www.tortall.net/projects/yasm/releases/yasm-1.3.0.tar.gz
        sha256: 3dce6601b495f5b3d455721e8983833f0e347397128253a4cca4c8973b116b34

  - name: libvpx
    sources:
      - type: git
        url: https://chromium.googlesource.com/webm/libvpx
        tag: v1.13.1
        commit: 17469f4935414652c71a36410486b3d441865e9d
  
  # GStreamer plugins for PipeWire support
  - name: gst-plugins-base
    buildsystem: meson
    sources:
      - type: git
        url: https://gitlab.freedesktop.org/gstreamer/gst-plugins-base.git
        tag: 1.24.0
  
  - name: gst-plugins-good
    buildsystem: meson
    sources:
      - type: git
        url: https://gitlab.freedesktop.org/gstreamer/gst-plugins-good.git
        tag: 1.24.0
        
  - name: ffmpeg
    buildsystem: autotools
    config-opts:
      - --enable-shared
      - --disable-static
      - --disable-doc
      - --disable-debug
      - --enable-gpl
      - --enable-version3
      - --enable-libvpx
      - --enable-libpipewire
    sources:
      - type: archive
        url: https://ffmpeg.org/releases/ffmpeg-6.1.1.tar.xz
        sha256: 8684f4b00f94b85461884c3719382f1261f0d9eb3d59640a1f4ac0873616f968

  - name: simpleshot
    buildsystem: simple
    build-commands:
      - install -Dm755 simpleshot.py ${FLATPAK_DEST}/bin/simpleshot
      - install -Dm644 net.bloupla.simpleshot.desktop ${FLATPAK_DEST}/share/applications/net.bloupla.simpleshot.desktop
      - install -Dm644 net.bloupla.simpleshot.metainfo.xml ${FLATPAK_DEST}/share/metainfo/net.bloupla.simpleshot.metainfo.xml
      - install -Dm644 icons/net.bloupla.simpleshot.svg ${FLATPAK_DEST}/share/icons/hicolor/scalable/apps/net.bloupla.simpleshot.svg
    sources:
      - type: git
        url: https://github.com/llaa33219/SimpleShot.git
        tag: v1.0.0
        commit: COMMIT_HASH_HERE  # Update this with actual commit hash after first release

